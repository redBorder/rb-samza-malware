package net.redborder.samza.util;

import org.apache.http.HttpResponse;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.DefaultHttpClient;
import org.codehaus.jackson.map.ObjectMapper;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.util.Map;

public class HTTP {

    public enum METHOD_HTTP{
        GET, POST, PUT, PATCH
    }

    private static final Logger log = LoggerFactory.getLogger(HTTP.class);

    public static HttpResponse lastResponse;

    public static void post(String url, Map<String, Object> parameters){

        DefaultHttpClient httpClient = new DefaultHttpClient();
        HttpPost postRequest = new HttpPost(url);

        ObjectMapper mapper = new ObjectMapper();

        try {
            StringEntity input = new StringEntity(mapper.writeValueAsString(parameters));
            input.setContentType("application/json");
            postRequest.setEntity(input);

            lastResponse = httpClient.execute(postRequest);

            if(lastResponse.getStatusLine().getStatusCode() != 200){
                log.info("["+METHOD_HTTP.POST.name()+"] : Response with code - " + lastResponse.getStatusLine().getStatusCode());
            }else{
                log.info("["+METHOD_HTTP.POST.name()+"] : Success response");
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static HttpResponse getLastResult(){
        return lastResponse;
    }

}
