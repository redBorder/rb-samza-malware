package net.redborder.samza.util;

import org.apache.commons.compress.utils.IOUtils;
import org.apache.http.HttpResponse;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.DefaultHttpClient;
import org.codehaus.jackson.map.ObjectMapper;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.util.Map;

public class HttpHelper {

    public enum METHOD_HTTP {
        GET, POST, PUT, PATCH
    }

    private static final Logger log = LoggerFactory.getLogger(HttpHelper.class);

    public static HttpResponse lastResponse;

    public static void post(String url, Map<String, Object> parameters) {

        DefaultHttpClient httpClient = new DefaultHttpClient();
        HttpPost postRequest = new HttpPost(url);

        ObjectMapper mapper = new ObjectMapper();

        try {
            StringEntity input = new StringEntity(mapper.writeValueAsString(parameters));
            input.setContentType("application/json");
            postRequest.setEntity(input);

            lastResponse = httpClient.execute(postRequest);

            if (lastResponse.getStatusLine().getStatusCode() != 200) {
                log.warn("[" + METHOD_HTTP.POST.name() + "] : Response with code - {} - Msg: {}",
                        lastResponse.getStatusLine().getStatusCode(),
                        org.apache.commons.io.IOUtils.toString(lastResponse.getEntity().getContent()));

            } else {
                log.debug("[" + METHOD_HTTP.POST.name() + "] : Success response");
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static HttpResponse getLastResult() {
        return lastResponse;
    }

}
